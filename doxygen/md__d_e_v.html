<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>libkinetic: Libkinetic developer note</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">libkinetic
   &#160;<span id="projectnumber">0.0.1</span>
   </div>
   <div id="projectbrief">Organize your form UI better</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('md__d_e_v.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Libkinetic developer note </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><blockquote class="doxtable">
<p>This document is intended for developers who want to contribute to libkinetic's own development. For libkinetic users, read <a class="el" href="_r_e_a_d_m_e_8md.html">the README</a> instead. </p>
</blockquote>
<h2>Node vs Component</h2>
<p>The characteristics (attributes, children, special behaviour, etc.) of each XML element (node) are implemented in <code>KineticComponent</code>s. For example, the root node is characterized by the <code>RootComponent</code> class. Each node may have multiple components, representing different parts of its characteristics.</p>
<h3>Component dependency</h3>
<p>Each component class should extend <code>KineticComponent</code> directly, except for very special circumstances.</p>
<p>If a component only works correctly when used with another component, it can override the <code>KineticComponent::dependsComponents()</code> method. This method should return an Iterator object (typically a Generator), so subclasses can add lines like <code>yield XxxComponent::class;</code> to declare the components they require. These classes will be appended to the list of components in the node.</p>
<p>Each component class is only added to the same component once, even if multiple components depend on it.</p>
<p><code>dependComponents()</code> is called before any attributes or children are passed to the component. Thus, its result should not change according to the attributes.</p>
<h3>Attributes</h3>
<p>If the component consumes XML attributes, it should override the <code>setAttribute(string $name, string $value)</code> method, which is called when the parser reaches the line of the node. <code>$name</code> is the attribute name in uppercase (because attributes are case-insensitive). The implementation should return <code>true</code> if it consumed the attribute, <code>false</code> otherwise.</p>
<p>In case of incorrect values (but not when an attribute from another component is read), the component implementation can call <code>$this-&gt;throw()</code> to throw an exception based on the specified node. Libkinetic will append information about the error node to the exception message.</p>
<p><code><a class="el" href="namespace_s_o_fe_1_1_libkinetic_1_1_element.html#a18028d15d34abf43062d71286972d573">setAttribute()</a></code> is executed in the parser context, i.e. it may be executed in a non-PocketMine runtime, such as a virion CLI tool. Hence, it should not attempt to call any PocketMine API methods (unless polyfilled) or verify/use any normal server runtime information (such as config values and external classes). Do this in <code>resolve()</code> instead.</p>
<p>The <code>$value</code> is always an as-is string from the XML attribute. To interpret it as other types, the following methods are useful:</p>
<div class="fragment"><div class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">function</span> KineticComponent::parseBoolean(<span class="keywordtype">string</span>) : bool;</div><div class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">function</span> KineticComponent::parseInt(<span class="keywordtype">string</span>) : int;</div><div class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">function</span> KineticComponent::parseFloat(<span class="keywordtype">string</span>) : float;</div></div><!-- fragment --><p>Do not call these methods if the value can be customized in a config with the <code>config:</code> prefix.</p>
<p>If the attribute uses a different namespace than <code><a href="https://rawgit.com/SOF3/libkinetic/master/libkinetic.xsd">https://rawgit.com/SOF3/libkinetic/master/libkinetic.xsd</a></code>, it should override <code>setAttributeNS(string $name, string $value, string $ns)</code> instead.</p>
<h3>Child nodes</h3>
<p>If the component enables the node to have child XML elements, it should override the <code>startChild(string $name)</code> method, which is called when the parser reaches the line with the child node. <code>$name</code> is the child element name in uppercase. The implementation should return the <code>KineticNode</code> created, initialized with the relevant components, or <code>null</code> if <code>$name</code> is not known by this component.</p>
<p><code><a class="el" href="namespace_s_o_fe_1_1_libkinetic_1_1_element.html#aed86a282e88fd88ba4eb68dc21238750">startChild()</a></code> is executed in the parser context, i.e. it may be executed in a non-PocketMine runtime, such as a virion CLI tool. Hence, it should not attempt to call any PocketMine API methods (unless polyfilled) or verify/use any normal server runtime information (such as config values and external classes). Do this in <code>resolve()</code> instead.</p>
<p>The resultant <code>KineticNode</code> can be constructed by the method <code>KienticNode::create(string ...$classes)</code>, where <code>$classes</code> is a variadic array of <code>KineticComponent</code> subclass names. Components can also fluently store the relevant components into their class fields using the methods declared in the <code>ComponentAdapter</code> trait, which is generated from <a href="tools/generateAdapter.php"><code>generateAdapter.php</code></a>.</p>
<p>If the element uses a different namespace than <code><a href="https://rawgit.com/SOF3/libkinetic/master/libkinetic.xsd">https://rawgit.com/SOF3/libkinetic/master/libkinetic.xsd</a></code>, it should override <code>startChildNS(string $name, string $ns)</code> instead.</p>
<h3>Character data</h3>
<p>If the component accepts XML character data, it should override the <code>acceptText(string $text)</code> method, which is called when the parser reaches the end of a chunk of character data. <code>$text</code> is the data trimmed and unwrapped.</p>
<p>It is not advisable to use character data together with child nodes, as the syntax becomes very strange. It is also not desirable to accept multiline content in character data, confusion with indentation and line wrapping may arise.</p>
<h3>Validation</h3>
<p>There are two types of validation: static validation and runtime validation.</p>
<p>Static validation refers to the validation executed in the parser context. Apart from the initial loading of the kinetic file in a normal server runtime, static validation is also executed in the <code>validate</code> and <code>def</code> CLI tools. Static validation should only check if the kinetic is syntactically well-formed and valid, i.e. it does not contain unsupported elements/attributes or incorrect combinations of them.</p>
<p>Runtime validation refers to the validation only executed in the manager context. The manager context has a dependency on the PocketMine plugin framework, so it is only executed during server runtime. Runtime validation can carry out checks on runtime environment and plugin code, such as whether a declared class name is undefined, check certain config values, etc.</p>
<p>Static validation should be implemented in <code><a class="el" href="namespace_s_o_fe_1_1_libkinetic_1_1_element.html#a3362a540cf1709d68dbb00e9b0c48f0c">KineticComponent::endElement()</a></code>, which is called after an XML element ends (closing tag <code>&lt;/element&gt;</code> or self-closing tag <code>&lt;element/&gt;</code>). There are several commonly-used helper methods for static validation:</p>
<div class="fragment"><div class="line"><span class="keyword">protected</span> <span class="keyword">final</span> <span class="keyword">function</span> requireAttribute(<span class="keywordtype">string</span> $name, &amp;$field); <span class="comment">// checks if $field is set; throw &quot;Required attribute $name missing&quot; if not set</span></div><div class="line"><span class="keyword">protected</span> <span class="keyword">final</span> <span class="keyword">function</span> requireChild(<span class="keywordtype">string</span> $name, &amp;$field); <span class="comment">// checks if $field is set; throw &quot;Required child $name missing&quot; if not set</span></div><div class="line"><span class="keyword">protected</span> <span class="keyword">final</span> <span class="keyword">function</span> requireChildren(<span class="keywordtype">string</span> $name, array $field, <span class="keywordtype">int</span> $min, <span class="keywordtype">int</span> $max = <a class="code" href="namespace_p_h_p___i_n_t___m_a_x.html">PHP_INT_MAX</a>); <span class="comment">// checks if $field contains an array of [$min, $max] elements; throw &quot;Required child $name missing&quot; if not set</span></div><div class="line"><span class="keyword">protected</span> <span class="keyword">final</span> <span class="keyword">function</span> requireText(<span class="keywordtype">string</span> $name, array $field, <span class="keywordtype">int</span> $min, <span class="keywordtype">int</span> $max = <a class="code" href="namespace_p_h_p___i_n_t___m_a_x.html">PHP_INT_MAX</a>); <span class="comment">// checks if $field is set; throw exception if not set</span></div></div><!-- fragment --><p>Runtime validation should be implemented in <code>KineticComponent::resolve()</code>, which is called after the parser has completed. It is called in the same sequence as that of the appearance of the start tags in the XML file. There are several commonly-used helper methods for runtime validation:</p>
<p>```php protected final function requireTranslation(?string $identifier); // check if the translation $identifier is either null or defined in the translation provider (<a class="el" href="namespace_s_o_fe_1_1_libkinetic.html#a81ec8a8e40b22d53bc601fd5d6f13b15">KineticAdapterBase::hasMessage()</a>) protected final function resolveClass(?string $fqn, ?string $super); // check if the class exists according to the libkinetic Instantiable notation and implements the interface $super protected final function resolveConfigString(?string &amp;$string); // resolve the field $string into a string from config if it starts with <code>config:</code> protected final function resolveConfigNumber(&amp;$number); // resolve the field $number into a number from config if it starts with <code>config:</code>, otherwise parse it protected final function resolveConfigBool(&amp;$bool); // resolve the field $bool into a boolean from config if it starts with <code>config:</code>, otherwise prase it ``` </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.14 </li>
  </ul>
</div>
</body>
</html>
