<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>libkinetic: DEV.md Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">libkinetic
   &#160;<span id="projectnumber">0.0.1</span>
   </div>
   <div id="projectbrief">Organize your form UI better</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('_d_e_v_8md.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">DEV.md</div>  </div>
</div><!--header-->
<div class="contents">
<a href="_d_e_v_8md.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;# Libkinetic developer note</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;&gt; This document is intended for developers who want to contribute to libkinetic&#39;s own development. For libkinetic users, read [the README](README.md) instead.</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;## Node vs Component</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;The characteristics (attributes, children, special behaviour, etc.) of each XML element (node) are implemented in `KineticComponent`s. For example, the root node is characterized by the `RootComponent` class. Each node may have multiple components, representing different parts of its characteristics.</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;### Component dependency</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;Each component class should extend `KineticComponent` directly, except for very special circumstances.</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;If a component only works correctly when used with another component, it can override the `KineticComponent::dependsComponents()` method. This method should return an Iterator object (typically a Generator), so subclasses can add lines like `yield XxxComponent::class;` to declare the components they require. These classes will be appended to the list of components in the node.</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;Each component class is only added to the same component once, even if multiple components depend on it.</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;`dependComponents()` is called before any attributes or children are passed to the component. Thus, its result should not change according to the attributes.</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;### Attributes</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;If the component consumes XML attributes, it should override the `setAttribute(string $name, string $value)` method, which is called when the parser reaches the line of the node. `$name` is the attribute name in uppercase (because attributes are case-insensitive). The implementation should return `true` if it consumed the attribute, `false` otherwise.</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;In case of incorrect values (but not when an attribute from another component is read), the component implementation can call `$this-&gt;throw()` to throw an exception based on the specified node. Libkinetic will append information about the error node to the exception message.</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;</div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;`setAttribute()` is executed in the parser context, i.e. it may be executed in a non-PocketMine runtime, such as a virion CLI tool. Hence, it should not attempt to call any PocketMine API methods (unless polyfilled) or verify/use any normal server runtime information (such as config values and external classes). Do this in `resolve()` instead.</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;The `$value` is always an as-is string from the XML attribute. To interpret it as other types, the following methods are useful:</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;```php</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;public final function KineticComponent::parseBoolean(string) : bool;</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;public final function KineticComponent::parseInt(string) : int;</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;public final function KineticComponent::parseFloat(string) : float;</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;```</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;Do not call these methods if the value can be customized in a config with the `config:` prefix.</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;If the attribute uses a different namespace than `https://rawgit.com/SOF3/libkinetic/master/libkinetic.xsd`, it should override `setAttributeNS(string $name, string $value, string $ns)` instead.</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;### Child nodes</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;If the component enables the node to have child XML elements, it should override the `startChild(string $name)` method, which is called when the parser reaches the line with the child node. `$name` is the child element name in uppercase. The implementation should return the `KineticNode` created, initialized with the relevant components, or `null` if `$name` is not known by this component.</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;`startChild()` is executed in the parser context, i.e. it may be executed in a non-PocketMine runtime, such as a virion CLI tool. Hence, it should not attempt to call any PocketMine API methods (unless polyfilled) or verify/use any normal server runtime information (such as config values and external classes). Do this in `resolve()` instead.</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;The resultant `KineticNode` can be constructed by the method `KienticNode::create(string ...$classes)`, where `$classes` is a variadic array of `KineticComponent` subclass names. Components can also fluently store the relevant components into their class fields using the methods declared in the `ComponentAdapter` trait, which is generated from [`generateAdapter.php`](tools/generateAdapter.php).</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;If the element uses a different namespace than `https://rawgit.com/SOF3/libkinetic/master/libkinetic.xsd`, it should override `startChildNS(string $name, string $ns)` instead.</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;### Character data</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;If the component accepts XML character data, it should override the `acceptText(string $text)` method, which is called when the parser reaches the end of a chunk of character data. `$text` is the data trimmed and unwrapped.</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;It is not advisable to use character data together with child nodes, as the syntax becomes very strange. It is also not desirable to accept multiline content in character data, confusion with indentation and line wrapping may arise.</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;### Validation</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;There are two types of validation: static validation and runtime validation.</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;Static validation refers to the validation executed in the parser context. Apart from the initial loading of the kinetic file in a normal server runtime, static validation is also executed in the `validate` and `def` CLI tools. Static validation should only check if the kinetic is syntactically well-formed and valid, i.e. it does not contain unsupported elements/attributes or incorrect combinations of them.</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;Runtime validation refers to the validation only executed in the manager context. The manager context has a dependency on the PocketMine plugin framework, so it is only executed during server runtime. Runtime validation can carry out checks on runtime environment and plugin code, such as whether a declared class name is undefined, check certain config values, etc.</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;Static validation should be implemented in `KineticComponent::endElement()`, which is called after an XML element ends (closing tag `&lt;/element&gt;` or self-closing tag `&lt;element/&gt;`). There are several commonly-used helper methods for static validation:</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;```php</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;protected final function requireAttribute(string $name, &amp;$field); // checks if $field is set; throw &quot;Required attribute $name missing&quot; if not set</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;protected final function requireChild(string $name, &amp;$field); // checks if $field is set; throw &quot;Required child $name missing&quot; if not set</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;protected final function requireChildren(string $name, array $field, int $min, int $max = PHP_INT_MAX); // checks if $field contains an array of [$min, $max] elements; throw &quot;Required child $name missing&quot; if not set</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;protected final function requireText(string $name, array $field, int $min, int $max = PHP_INT_MAX); // checks if $field is set; throw exception if not set</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;```</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;Runtime validation should be implemented in `KineticComponent::resolve()`, which is called after the parser has completed. It is called in the same sequence as that of the appearance of the start tags in the XML file. There are several commonly-used helper methods for runtime validation:</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;```php</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;protected final function requireTranslation(?string $identifier); // check if the translation $identifier is either null or defined in the translation provider (KineticAdapterBase::hasMessage())</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;protected final function resolveClass(?string $fqn, ?string $super); // check if the class exists according to the libkinetic Instantiable notation and implements the interface $super</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;protected final function resolveConfigString(?string &amp;$string); // resolve the field $string into a string from config if it starts with `config:`</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;protected final function resolveConfigNumber(&amp;$number); // resolve the field $number into a number from config if it starts with `config:`, otherwise parse it</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;protected final function resolveConfigBool(&amp;$bool); // resolve the field $bool into a boolean from config if it starts with `config:`, otherwise parse it</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;```</div></div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="_d_e_v_8md.html">DEV.md</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.14 </li>
  </ul>
</div>
</body>
</html>
